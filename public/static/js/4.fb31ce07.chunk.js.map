{"version":3,"sources":["hooks/useResizeObserver.js","components/Graph/CoronaVirusGraph.jsx"],"names":["useResizeObserver","colors","GraphComp","props","chartData","width","chartType","height","data","margin","top","right","bottom","left","type","dataKey","stroke","strokeDasharray","fill","defaultProps","Graph","memo","GraphContainerComp","size","reduce","acc","curr","i","self","slice","map","chart","key","City","GraphContainer","CoronaGraph","useState","fetchTime","setFetchTime","setChartData","origChartData","useRef","dataUpdatedAt","setDataUpdatedAt","ref","useFetch","url","window","location","href","retries","loading","setChartType","selectedCountry","setSelectedCountry","countries","setCountries","getTotalOf","useCallback","value","current","country","useEffect","updateTime","results","humanReadableTime","moment","format","newChartData","dataObject","history","countryInHistory","countryEnglishName","countryName","Dead","deadCount","Cured","curedCount","Infected","confirmedCount","Object","values","sort","a","b","String","localeCompare","makeChartData","Date","now","c","className","onChange","e","target","onClick","newData","filter","removeCountryFromData"],"mappings":"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","file":"static/js/4.fb31ce07.chunk.js","sourcesContent":["import { useState, useCallback } from 'react'\nimport { useDebouncedFn, useThrottledFn } from 'beautiful-react-hooks'\nimport useResizeObserver from 'use-resize-observer';\n\nexport const useResizeObserverThrottled = wait => {\n  const [size, setSize] = useState({});\n  const onResize = useThrottledFn(setSize, wait)\n  const { ref } = useResizeObserver({ onResize });\n\n  return { ref, ...size };\n};\n\nexport const useResizeObserverDebounced = wait => {\n  const [size, setSize] = useState({});\n  const options = {\n    leading: false,\n    trailing: true,\n  };\n  const onResizeFN = useDebouncedFn(setSize, wait, options)\n  const onResize = useCallback((...arg) => onResizeFN(...arg), [onResizeFN])\n  const { ref } = useResizeObserver({ onResize });\n\n  return { ref, ...size };\n};\n\nexport default useResizeObserver;","import React, { useEffect, useState, useRef, useCallback, memo } from \"react\";\n// import { useLocation, useHistory, useRouteMatch } from 'react-router-dom'\n\nimport {\n  LineChart,\n  BarChart,\n  CartesianGrid,\n  YAxis,\n  XAxis,\n  Tooltip,\n  Line,\n  Bar,\n  Legend\n} from \"recharts\";\nimport moment from \"moment\";\nimport useFetch from \"use-http\";\n\nimport useResizeObserver from '../../hooks/useResizeObserver';\n// import useWhyDidYouUpdate from '../../hooks/useWhyDidYouUpdate'\n\n\nconst colors = {\n  dead: \"#ff0000\",\n  cured: \"#25bafa\",\n  infected: \"#c2b527\"\n}\n\nconst GraphComp = props => {\n  const { chartData, width, chartType } = props;\n\n  if (chartType === \"bar\") {\n    return (\n      <>\n        <BarChart\n          width={width}\n          height={300}\n          data={chartData}\n          margin={{ top: 5, right: 20, bottom: 5, left: 0 }}\n        >\n          <Line type=\"monotone\" dataKey=\"uv\" stroke=\"#8884d8\" />\n          <CartesianGrid stroke=\"#ccc\" strokeDasharray=\"5 5\" />\n          <XAxis dataKey=\"City\" />\n          <YAxis />\n          <Tooltip />\n          <Legend />\n          <Bar dataKey=\"Dead\" fill={colors.dead} />\n          <Bar dataKey=\"Cured\" fill={colors.cured} />\n          <Bar dataKey=\"Infected\" fill={colors.infected} />\n        </BarChart>\n        <br />\n      </>\n    );\n  }\n\n  return (\n    <>\n      <LineChart data={chartData} width={width} height={300}>\n        <Line type=\"monotone\" dataKey=\"Dead\" stroke={colors.dead} />\n        <Line type=\"monotone\" dataKey=\"Cured\" stroke={colors.cured} />\n        <Line type=\"monotone\" dataKey=\"Infected\" stroke={colors.infected} />\n        <CartesianGrid stroke=\"#ccc\" strokeDasharray=\"5 5\" />\n        <XAxis dataKey=\"City\" />\n        <YAxis />\n        <Tooltip />\n        <Legend />\n      </LineChart>\n      <br />\n    </>\n  );\n};\n\nGraphComp.defaultProps = {\n  chartData: [],\n  width: 600,\n  chartType: \"line\"\n};\n\nconst Graph = memo(GraphComp);\n\nconst GraphContainerComp = props => {\n  const { chartData, width, size, chartType } = props;\n\n  return chartData\n    .reduce((acc, curr, i, self) => {\n      if (!(i % size)) {\n        return [...acc, self.slice(i, i + size)];\n      }\n      return acc;\n    }, [])\n    .map((chart, i) => (\n      <Graph\n        // key={\"graph-\" + i}\n        key={chart[0].City}\n        chartType={chartType}\n        chartData={chart}\n        width={width}\n      />\n    ));\n};\n\nGraphContainerComp.defaultProps = {\n  chartData: [],\n  width: 600,\n  size: 10,\n  chartType: \"line\"\n}\n\nconst GraphContainer = memo(GraphContainerComp);\n\nconst CoronaGraph = props => {\n  const [fetchTime, setFetchTime] = useState(0);\n  const [chartData, setChartData] = useState(null);\n  const origChartData = useRef();\n  const [dataUpdatedAt, setDataUpdatedAt] = useState(0);\n  \n  const { ref, width = 1 } = useResizeObserver();\n  // const { ref, width = 1 } = useResizeObserverDebounced();\n  const { data, loading } = useFetch(\n    {\n      // url: \"https://lab.isaaclin.cn/nCoV/api/area\",\n      // url: \"http://localhost:4000/delayed\",\n      // url: \"http://localhost:4000/api\",\n      url: window.location.href + \"api\",\n      retries: 3\n    },\n    []\n  );\n\n  const [chartType, setChartType] = useState(\"bar\");\n  const [selectedCountry, setSelectedCountry] = useState(\"\");\n  const [countries, setCountries] = useState([]);\n\n  function makeChartData(data) {\n    const dataArray = data.results;\n    const dataObject = dataArray.reduce((history, country) => {\n      const countryInHistory =\n        history[country.countryEnglishName || country.countryName];\n\n      // Tjekker om vi har dette land allerede\n      if (countryInHistory) {\n        // Ligger nye data sammen med gamle data\n        countryInHistory.Dead += country.deadCount;\n        countryInHistory.Cured += country.curedCount;\n        countryInHistory.Infected += country.confirmedCount;\n        // } else if (country.countryEnglishName !== \"China\") {\n      } else {\n        // Hvis vi ikke har landet s√• skriver vi det til history\n        history[country.countryEnglishName || country.countryName] = {\n          City: country.countryEnglishName || country.countryName,\n          Dead: country.deadCount,\n          Cured: country.curedCount,\n          Infected: country.confirmedCount\n        };\n      }\n      return history;\n    }, {});\n\n    const sortedDataArray = Object.values(dataObject);\n    const alphabeticallySortedDataArray = sortedDataArray.sort((a, b) => {\n      return String(a.City).localeCompare(String(b.City));\n    });\n\n    return alphabeticallySortedDataArray;\n  }\n\n  const removeCountryFromData = country => {\n    if (chartData) {\n      const newData = chartData.filter(({ City }) => City !== country);\n      setChartData(newData);\n    }\n  };\n\n  const handleCountrySelect = e => {\n    setSelectedCountry(e.target.value);\n  };\n\n  const removeSelectedCountry = () => {\n    removeCountryFromData(selectedCountry);\n  };\n\n  const toggleBarType = () => {\n    if (chartType === \"line\") {\n      setChartType(\"bar\");\n    } else {\n      setChartType(\"line\");\n    }\n  };\n\n  const getTotalOf = useCallback(\n    value => {\n      if (origChartData.current) {\n        return origChartData.current.reduce(\n          (acc, country) => (acc += country[value]),\n          0\n        );\n      }\n    },\n    [origChartData]\n  );\n\n  useEffect(() => {\n    if (!chartData && !loading && data) {\n      const updateTime = data.results[0].updateTime;\n      const humanReadableTime = moment(updateTime).format(\"DD/MM-YYYY HH:mm\");\n      const newChartData = makeChartData(data);\n      setDataUpdatedAt(humanReadableTime);\n      origChartData.current = newChartData;\n      setChartData(newChartData);\n      setFetchTime(Date.now());\n      setCountries(newChartData.map(c => c.City));\n      setSelectedCountry(newChartData[0].City);\n    }\n  }, [chartData, data, loading]);\n\n\n  return (\n    <div className=\"fetch-div\" \n    ref={ref}\n    >\n      <p>\n        Data kommer fra: <a href=\"https://lab.isaaclin.cn/\">https://lab.isaaclin.cn/</a>\n      </p>\n      {!loading && (\n        <>\n          <p>Data er opdateret: {dataUpdatedAt} lokal tid</p>\n          <p>\n            Data blev hentet: {moment(fetchTime).format(\"DD/MM-YYYY HH:mm\")}\n          </p>\n          <p>Antal inficerede p√• verdensplan: {getTotalOf(\"Infected\")}</p>\n          <p>Antal kurerede p√• verdensplan: {getTotalOf(\"Cured\")}</p>\n          <p>Antal d√∏de p√• verdensplan: {getTotalOf(\"Dead\")}</p>\n        </>\n      )}\n      <select onChange={handleCountrySelect} value={selectedCountry}>\n        {countries.map((country, i) => (\n          <option key={\"country-option\" + i} value={country}>\n            {country}\n          </option>\n        ))}\n      </select>\n      <button onClick={removeSelectedCountry}>\n        Fjern det valge land fra graf\n      </button>{\" \"}\n      <button onClick={() => setChartData(origChartData.current)}>\n        Gendan original graf\n      </button>{\" \"}\n      <button onClick={toggleBarType}>\n        {chartType === \"line\" ? \"Vis som s√∏jlediagram\" : \"Vis graf\"}\n      </button>\n      {!loading && chartData && (\n        <GraphContainer\n          chartData={chartData}\n          chartType={chartType}\n          width={width}\n          size={10}\n        />\n      )}\n    </div>\n  );\n};\n\nexport default CoronaGraph;\n"],"sourceRoot":""}